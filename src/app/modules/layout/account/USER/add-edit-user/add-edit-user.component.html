<div class="bg-muted relative mx-auto flex h-[90vh] w-[800px] max-w-3xl flex-col overflow-hidden rounded-lg">
  <!-- Header -->
  <div class="flex flex-shrink-0 items-center justify-between border-b border-gray-700 p-6">
    <h2 class="text-xl font-semibold text-gray-100">
      {{ data?.id ? 'Edit User' : 'Add User' }}
    </h2>

    <button
      type="button"
      (click)="closeDialog()"
      class="cursor-pointer text-gray-400 transition hover:text-gray-200"
      aria-label="Close">
      <svg-icon src="assets/icons/heroicons/outline/x.svg" [svgClass]="'h-5 w-5'"></svg-icon>
    </button>
  </div>

  <!-- Scrollable Form Body -->
  <div class="scrollbar-thin scrollbar-thumb-gray-800 flex-1 space-y-5 overflow-y-auto px-6 py-4">
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <!-- Profile Picture Upload -->
      @if (data?.id) {
      <div class="mb-4">
        <div class="relative inline-block">
          <img
            [src]="base64Image || 'assets/logo/dummy-avatar.jpg'"
            class="h-32 w-32 rounded-full border-2 border-gray-600 object-cover" />
        </div>

        <div class="mt-3 flex items-center gap-2">
          <button
            type="button"
            (click)="onUpload()"
            class="bg-primary hover:bg-primary/80 ml-3 flex-none cursor-pointer rounded-md px-4 py-2.5 text-white">
            Upload
          </button>
        </div>

        <input type="file" #fileInput accept="image/*" (change)="onFileChange($event)" class="hidden" />

        @if (userForm.controls['userProfilePic'].errors) {
        <div class="mt-1 text-sm text-white">Profile picture is required.</div>
        }
      </div>
      }

      <!-- Text Fields -->
      <div class="grid grid-cols-2 gap-4">
        <!-- USERNAME -->
        <div>
          <label class="font-medium text-gray-200">Username <span class="text-white">*</span></label>
          <input type="text" formControlName="userName" class="input" placeholder="Enter username" />

          @if (userForm.controls['userName'].invalid && userForm.controls['userName'].touched) {
          <div class="text-sm text-white">Username is required.</div>
          }
        </div>

        <!-- EMAIL -->
        <div>
          <label class="font-medium text-gray-200">Email <span class="text-white">*</span></label>
          <input type="email" autocomplete="false" formControlName="email" class="input" placeholder="Enter email" />

          @if (userForm.controls['email'].errors) {
          <div class="text-sm text-white">
            @if (userForm.controls['email'].errors['required']) { Email is required. } @if
            (userForm.controls['email'].errors['email']) { Enter a valid email. }
          </div>
          }
        </div>

        <!-- FIRST NAME -->
        <div>
          <label class="font-medium text-gray-200">First Name <span class="text-white">*</span></label>
          <input type="text" formControlName="firstName" class="input" placeholder="Enter first name" />

          @if (userForm.controls['firstName'].invalid && userForm.controls['firstName'].touched) {
          <div class="text-sm text-white">First name is required.</div>
          }
        </div>

        <!-- LAST NAME -->
        <div>
          <label class="font-medium text-gray-200">Last Name <span class="text-white">*</span></label>
          <input type="text" formControlName="lastName" class="input" placeholder="Enter last name" />

          @if (userForm.controls['lastName'].invalid && userForm.controls['lastName'].touched) {
          <div class="text-sm text-white">Last name is required.</div>
          }
        </div>

        <!-- PASSWORD -->
        <div>
          <label class="font-medium text-gray-200">Password <span class="text-white">*</span></label>
          <input
            type="password"
            autocomplete="new-password"
            formControlName="password"
            class="input"
            placeholder="Enter password" />

          @if (userForm.controls['password'].invalid && userForm.controls['password'].touched) {
          <div class="text-sm text-white">Password is required.</div>
          }
        </div>

        <!-- PHONE -->
        <div>
          <label class="font-medium text-gray-200">Phone <span class="text-white">*</span></label>
          <input
            type="text"
            formControlName="phoneNumber"
            maxlength="10"
            class="input"
            placeholder="Enter phone number" />

          @if (userForm.controls['phoneNumber'].errors) {
          <div class="text-sm text-white">
            @if (userForm.controls['phoneNumber'].errors['required']) { Phone number is required. } @if
            (userForm.controls['phoneNumber'].errors['pattern']) { Only numeric digits are allowed. } @if
            (userForm.controls['phoneNumber'].errors['maxlength']) { Phone number cannot exceed 10 digits. }
          </div>
          }
        </div>

        <!-- COMPANY -->
        <div>
          <label class="font-medium text-gray-200">Company <span class="text-white">*</span></label>
          <input type="text" formControlName="companyName" class="input" placeholder="Company Name" />

          @if (userForm.controls['companyName'].invalid && userForm.controls['companyName'].touched) {
          <div class="text-sm text-white">Company name is required.</div>
          }
        </div>

        <!-- ADDRESS -->
        <div>
          <label class="font-medium text-gray-200">Address <span class="text-white">*</span></label>
          <input type="text" formControlName="address" class="input" placeholder="Address" />

          @if (userForm.controls['address'].invalid && userForm.controls['address'].touched) {
          <div class="text-sm text-white">Address is required.</div>
          }
        </div>

        <!-- ROLE -->
        <div>
          <label class="font-medium text-gray-200">Role <span class="text-white">*</span></label>

          <mat-form-field appearance="outline" class="w-full text-white">
            <mat-select formControlName="userRolesData" multiple placeholder="Select Roles" class="text-white">
              @for (role of roles; track role.value) {
              <mat-option [value]="role.value">
                {{ role.label }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if (userForm.controls['userRolesData'].invalid && (submitted || userForm.controls['userRolesData'].touched ||
          userForm.controls['userRolesData'].dirty)) {
          <div class="text-left text-sm text-white">
            @if (userForm.controls['userRolesData'].errors?.['required']) { Required field }
          </div>
          }
        </div>

        <!-- ACCOUNT -->
        <div>
          <label class="font-medium text-gray-200">Account <span class="text-white">*</span></label>
          <select formControlName="accountId" class="input">
            <option value="">Select Account</option>

            @for (acc of accounts; track acc.value) {
            <option [value]="acc.value">{{ acc.label }}</option>
            }
          </select>

          @if (userForm.controls['accountId'].invalid && userForm.controls['accountId'].touched) {
          <div class="text-sm text-white">Account selection is required.</div>
          }
        </div>
      </div>

      <!-- Status Toggle -->
      <div class="mt-5 flex items-center space-x-4">
        <label class="w-1/3 font-medium text-gray-200">Status:</label>

        <div class="flex w-2/3 items-center">
          <button
            type="button"
            (click)="toggleStatus()"
            class="relative inline-flex h-7 w-14 cursor-pointer items-center rounded-full transition-colors duration-300"
            [ngClass]="userForm.get('isActive')?.value ? 'bg-primary' : 'bg-gray-600'">
            <span
              class="absolute left-1 top-1 h-5 w-5 rounded-full bg-white shadow-md transition-transform duration-300"
              [ngStyle]="{
                transform: userForm.get('isActive')?.value ? 'translateX(28px)' : 'translateX(0px)'
              }"></span>
          </button>

          <span
            class="ml-3 text-sm font-medium"
            [ngClass]="userForm.get('isActive')?.value ? 'text-primary' : 'text-gray-400'">
            {{ userForm.get('isActive')?.value ? 'Active' : 'Inactive' }}
          </span>
        </div>
      </div>
    </form>
  </div>

  <!-- Sticky Footer -->
  <div class="bg-muted sticky bottom-0 flex flex-shrink-0 justify-end space-x-4 border-t border-gray-700 p-6">
    <button
      type="button"
      (click)="closeDialog()"
      class="cursor-pointer rounded border border-gray-600 px-6 py-2 text-gray-300 transition hover:bg-gray-800 hover:text-white">
      CANCEL
    </button>

    <button
      type="submit"
      (click)="onSubmit()"
      class="bg-primary flex-none cursor-pointer rounded-md px-4 py-2.5 text-white disabled:cursor-not-allowed disabled:opacity-50">
      {{ data?.id ? 'UPDATE' : 'SAVE' }}
    </button>
  </div>
</div>
